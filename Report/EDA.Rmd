---
title: "DA_Project"
author: "Nina"
date: "4/20/2022"
output: html_document
---

```{r, echo = FALSE, message = FALSE}
source(here::here("Scripts/SetUp.R"))
```

### Part 3 : Exploratory Data Analysis (EDA)

This section is dedicated to understanding the data. We will provide an analysis of the data set using a visual approach in order to summarize their main characteristics.

## 3.1 Data structure and summary
```{r }
x<-inspect_types(bands3_reduced)
show_plot(x, col_palette=2)
```
We have 17 numerical variables and 12 character variables. This will help us in the choice of the model for the analysis part.

## 3.2 Data structure 
```{r }
head(bands3_reduced)
describe(bands3_reduced)
as_tibble(bands3_reduced)
datatable(bands3_reduced)
```
## 3.3 Data summary
```{r }
dfSummary(bands3_reduced, style = "grid")
```
From the 'dfSummary' function, we notice that we have 42,2 % of data with "band" and 57,8% of data with "noband". We believe at this stage that it will not be necessary to balance the data, but we may have to do it later in case some models do not give satisfactory results. 

## 3.4 Data Expolrer library
```{r }
introduce(bands3_reduced)
plot_intro(bands3_reduced)
```
We can see that we have more continuous columns than discrete columns, nevertheless the gap is not so big. 
It's also interesting to see that we don't have any all missing columns and that 52% of our dataset are complete rows.
We have 5.1% of missing observations which we will look at in more detail just below.

## 3.4.1 Missing observations

It is important to analyze missing data since they can bias the results and interpretations if they are too large in number or distributed in a certain way.

# Missing data histogram
```{r}
x<-inspect_na(bands3_reduced)
show_plot(x, col_palette=5)
```
Overall, the missing observations are not egregious in our dataset. Nevertheless, we will have to pay attention to the variable *location* in which we still find 28,9% of the columns that is NA. An analysis according to this variable will therefore probably only be slightly representative and useful. 
We also notice that there is a tendency to have more missing observations in the numerical variables than characteristics one.

Moreover, we will now make a separate visual analysis of these two types of variables in order to extract their specificities and adapt the rest of our report accordingly. 

## 3.4.2 We plot the numerical variables: 

# Histograms
```{r }
plot_histogram(bands3_reduced)
```
??? Faire analyse ???

# Density plots
```{r }
plot_density(bands3_reduced,
             ggtheme = theme_bw()) # Density plots
```
??? Faire analyse ???

# Side-by-side boxplots
```{r}
plot_boxplot(bands3_reduced, by = 'band_type',  ncol = 2,
             title = "Side-by-side boxplots") # Boxplot
```
??? Faire analyse + intéeressant pour outliers ???


# ???
```{r }
table(bands3_reduced$band_type) %>% kable(align = "c", col.names = c("Variable", "Frequence"))
```

```{r, echo = FALSE, message = FALSE, warning = FALSE, figures-side1, fig.show="hold" ,out.width="50%"}
a<- bands3_reduced %>%
    explore(grain_screened, target = band_type)
b<- bands3_reduced %>%
    explore(proof_ink, target = band_type)
c<- bands3_reduced %>%
    explore(paper_type, target = band_type)
d<- bands3_reduced %>%
    explore(ink_type, target = band_type)
e<- bands3_reduced %>%
    explore(press_type, target = band_type)
f<- bands3_reduced %>%
    explore(press, target = band_type)
g<- bands3_reduced %>%
    explore(location, target = band_type)
h<- bands3_reduced %>%
    explore(proof_cut, target = band_type)
i<- bands3_reduced %>%
    explore(ink_temperature, target = band_type)
j<- bands3_reduced %>%
    explore(roughness, target = band_type)
k<- bands3_reduced %>%
    explore(press_speed, target = band_type)
l<- bands3_reduced %>%
    explore(wax, target = band_type)
m<- bands3_reduced %>%
    explore(hardener, target = band_type)

(a / b / c + plot_annotation(title = '?'))
(d / e   + plot_annotation(title = '?'))
(f / g  + plot_annotation(title = '?'))
(h / i  + plot_annotation(title = '?'))
(j / k + plot_annotation(title = '?'))
(l/ m + plot_annotation(title = '?'))

#plot_grid(a, b, c, d, e, f, g, h, i, j, k, l, m, dncol = 2, nrow = 7) #affichage pas ouf, à revoir
```

grain_screened, proof_ink, paper_type, ink_type, press_type, press, location, proof_cut, ink_temperature, roughness,  press_speed, wax, hardener, are the variables for which we observe a greater distinction between the presence of 'band' and 'noband'.

## 3.4.3 We plot the categorical variables: 

# Bar graph
```{r}
bands3_reduced %>%
  keep(is.character) %>%
  gather() %>%
  ggplot(aes(value)) +
  facet_wrap(~ key, scales = "free") +
  geom_bar(stat="count") +
  coord_flip()
```
Firstly, it is important to note that the data is rather balanced. 
??? Faire analyse ???

## 4. Variables summaries of quantitative variables 
```{r }
quali <- c(29,1:11)
quanti<-12:28
mat<-matrix(0, length(quanti), 7)
colnames(mat)<-c("Min.", "1st Qu.", "Median", "Mean", "Sd", "3rd Qu.", "Max.")
rownames(mat)<-names(bands3_reduced)[quanti]
mat[,1]<-apply(bands3_reduced[,quanti], 2, min, na.rm=TRUE)
mat[,2]<-apply(bands3_reduced[,quanti], 2, quantile, 0.25, na.rm=TRUE)
mat[,3]<-apply(bands3_reduced[,quanti], 2, median, na.rm=TRUE)
mat[,4]<-apply(bands3_reduced[,quanti], 2, mean, na.rm=TRUE)
mat[,5]<-apply(bands3_reduced[,quanti], 2, sd, na.rm=TRUE)
mat[,6]<-apply(bands3_reduced[,quanti], 2, quantile, 0.75, na.rm=TRUE)
mat[,7]<-apply(bands3_reduced[,quanti], 2, max, na.rm=TRUE)
print(round(mat, 2))
```


# 5. Pairwise comparisons (matrix of scatterplots and correlations)

We split numerical and categorical variables 
## 5.1 Correlation plot between numerical variables
```{r}
bands3_reduced.num<-bands3_reduced[,quanti]
bands3_reduced.categoric <- bands3_reduced[,quali]
plot_correlation(bands3_reduced.num, type= 'c', cor_args = list( 'use' = 'complete.obs'))
```
No correlation, independant variables except 'ink_pct' & 'varnish_pct' (nagatively correlated).

## 5.2 Relationships between continuous variables
```{r}
bands3_continuous <- bands3_reduced.num[,c(3,6,8,10:13)]
plot_correlation(bands3_continuous, type= 'c', cor_args = list( 'use' = 'complete.obs'))
```


## 6. Outliers
```{r}
summary(bands3_reduced)
``` 

## 7. Boruta algo 

```{r}
#we treat the missing values 
bands3_reducedNA <- bands3_reduced[complete.cases(bands3_reduced),]
#convert categoric into factor
#quali <- c(29,1:11)
convert <- c(29, 1:11)
#bands3_reduced[,convert] <- data.frame(apply(bands3_reduced[convert], 2, #as.factor))  --> marche pas donc 1 par 1 

bands3_reducedNA$grain_screened <- as.factor(bands3_reducedNA$grain_screened)
bands3_reducedNA$proof_ink <- as.factor(bands3_reducedNA$proof_ink)
bands3_reducedNA$paper_type <- as.factor(bands3_reducedNA$paper_type)
bands3_reducedNA$ink_type <- as.factor(bands3_reducedNA$ink_type)
bands3_reducedNA$solvent_type <- as.factor(bands3_reducedNA$solvent_type)
bands3_reducedNA$cylinder_type <- as.factor(bands3_reducedNA$cylinder_type)
bands3_reducedNA$press_type <- as.factor(bands3_reducedNA$press_type)
bands3_reducedNA$press <- as.factor(bands3_reducedNA$press)
bands3_reducedNA$cylinder_size <- as.factor(bands3_reducedNA$cylinder_size)
bands3_reducedNA$location <- as.factor(bands3_reducedNA$location)
bands3_reducedNA$plating_tank <- as.factor(bands3_reducedNA$plating_tank)
bands3_reducedNA$band_type <- as.factor(bands3_reducedNA$band_type)

#library(Boruta)
#library(targets)
# Decide if a variable is important or not using Boruta
set.seed(123)
boruta_output <- Boruta(band_type ~ . , data=bands3_reducedNA, doTrace=2) # perform Boruta search

plot(boruta_output, xlab = "", xaxt = "n")
lz<-lapply(1:ncol(boruta_output$ImpHistory),function(i)
boruta_output$ImpHistory[is.finite(boruta_output$ImpHistory[,i]),i])
names(lz) <- colnames(boruta_output$ImpHistory)
Labels <- sort(sapply(lz,median))
axis(side = 1,las=2,labels = names(Labels),
at = 1:ncol(boruta_output$ImpHistory), cex.axis = 0.7)

```


